{% extends "base.html" %}
{% load static %}
{% block content %}

{% url 'account_login' as login_url %}
{% url 'account_signup' as signup_url %}
{% url 'account_logout' as logout_url %}

<!--Search engine section-->
<!--Search toggle for medioum and small screens-->
<div>
    <button id="toggleSearchButton" class="control-btn">Search</button>
    <!--Search regular section-->
    <div id="juke-search" class="juke-container">
        <h2>Search</h2>
        <div>Search categories</div>
    </div>
</div>
<!--Juke Box media player section-->
<div id="juke-main" class="juke-container">
    <h1>Loch Inn Juke Box</h1>
    <div class="media-box">
        <div class="media-player">
            <div>
                Media Player
            </div>
        </div>
        <div class="media-controls">
            <span>
                <button id="previousButton" class="control-btn"><i class="fas fa-step-backward"></i></button>
                <p>Previous</p>                
            </span>
            <span>
                <button id="nextButton" class="control-btn"><i class="fas fa-step-forward"></i></button>
                <p>Next</p>                
            </span>
        </div>
    </div>

    <h2>Coming Up Next...</h2>
    <div>Carrousel</div>
</div>
<!--Chat section-->
<div id="juke-chat" class="juke-container">
    <h2>Live Chat</h2>
    <div>
        <input type="text" id="id_message_send_input" />
        <button type="submit" id="id_message_send_button">Send Message</button>
        <div class="chat__item__container" id="id_chat_item_container">
        </div>
        <script>
           const chatSocket = new WebSocket(
                (window.location.protocol === "https:" ? "wss://" : "ws://") + window.location.host + "/"
            );
            chatSocket.onopen = function (e) {
                console.log("The connection was setup successfully !");
            };
            chatSocket.onclose = function (e) {
                console.log("Something unexpected happened !");
            };
            document.querySelector("#id_message_send_input").focus();
            document.querySelector("#id_message_send_input").onkeyup = function (e) {
                if (e.keyCode == 13) {
                    document.querySelector("#id_message_send_button").click();
                }
            };
            document.querySelector("#id_message_send_button").onclick = function (e) {
                var messageInput = document.querySelector(
                    "#id_message_send_input"
                ).value;
                chatSocket.send(JSON.stringify({ message: messageInput, username: "{{request.user.username}}" }));
            };
            chatSocket.onmessage = function (e) {
                const data = JSON.parse(e.data);
                var div = document.createElement("div");
                div.innerHTML = data.username + " : " + data.message;
                document.querySelector("#id_message_send_input").value = "";
                document.querySelector("#id_chat_item_container").appendChild(div);
            };
        </script>
    </div>
</div>

{% endblock %}